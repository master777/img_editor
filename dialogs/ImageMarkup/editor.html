<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Image Markup</title>
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/paper-core.js"></script>
    <script src="js/paper-core.min.js"></script>
    <script src="js/paper-full.js"></script>
    <script src="js/paper-full.min.js"></script>    
    <!--<script src="js/lba_adaptor.js"></script>-->
    <link href="css/image-markup.css" rel="stylesheet" />
    <link href="contextMenu/jquery.contextMenu.css" rel="stylesheet" />
</head>
<body>
    <div>
<!--        <a href="#" onclick="lbaGenerateImage(CKEDITOR.config.img_editor_current_img)">RESETEAR</a>
        <a href="#" onclick="iniciarEdicion();">INICIAR EDICION</a>-->
        <a href="#" onclick="descargarImg();">Descargar</a>
        <!--<br/>-->
        <!--<div class="img-container"><img id="img-editable" src="exam/vermeer.jpg" /></div>-->
        <div id="img-container" class="img-container"><img id="img-editable" /></div>
    </div>

    <script src="js/CommandManager.js"></script>
    <script type="text/javascript" src="contextMenu/jquery.contextMenu.js"></script>
    <script type="text/javascript" src="contextMenu/jquery.ui.position.js"></script>
    <script type="text/javascript" src="js/image-markup.js"></script>
    <script type="text/javascript">
        console.log("Mostrando IFRAME");
        CKEDITOR = self.parent.CKEDITOR || {
            config: {}
        };
        var default_img = { 
            currentSrc: "exam/image_not_found.png", 
            src : "exam/image_not_found.png"
        };
        var current_img = CKEDITOR.config.img_editor_current_img || default_img;
        
        $(document).ready(function(){
            document.getElementById('img-editable').src = current_img.currentSrc;

            var markup = $('.img-container img').imageMarkup({ color: 'red', width: 4, opacity: .5 });
//            $('#img-editable').imageMarkup({ color: 'red', width: 4, opacity: .5 });  
        });
        
        function descargarImg(){
            // Recuperamos la instancia utilizada en el image-markup.js
            var markup = window.current_image_markup;
//            console.log("window.current_image_markup");
//            console.log(markup);
            
            markup.custom_download(obtenerImg);
        }
        
        function obtenerImg(url){
            console.log("Nueva IMG:");
            console.log(url);
            
//            CKEDITOR.img_editor_new_img_src = new_url;
        }
        
        self.parent.descargarImg = function descargarImg(success_function){
            // Recuperamos la instancia utilizada en el image-markup.js
            var markup = window.current_image_markup;            
            markup.custom_download(success_function);
        }
    </script>
</body>
</html>
