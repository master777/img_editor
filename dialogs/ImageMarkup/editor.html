<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Image Markup</title>
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/paper-core.js"></script>
    <script src="js/paper-core.min.js"></script>
    <script src="js/paper-full.js"></script>
    <script src="js/paper-full.min.js"></script>    
    <!--<script src="js/lba_adaptor.js"></script>-->
    <link href="css/image-markup.css" rel="stylesheet" />
    <link href="contextMenu/jquery.contextMenu.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="css/spectrum.css" />
</head>
<body>
    <div>
        <div id="toolbar-container">
            <button onclick="tb_undo()">UNDO</button>
            <button onclick="tb_redo()">REDO</button> &#124; 
            <button onclick="tb_select()">SELECT</button>
            <button onclick="tb_pen()">PEN</button>
            <button onclick="tb_text()">TEXT</button>
            <input type='text' id="custom-color" />
        </div>
        <br/>
        <div id="img-container" class="img-container"><img id="img-editable" src="#" alt="Editable Image" /></div>
        <div id="img_editor_loading"></div>
    </div>

    <script src="js/CommandManager.js"></script>
    <script type="text/javascript" src="contextMenu/jquery.contextMenu.js"></script>
    <script type="text/javascript" src="contextMenu/jquery.ui.position.js"></script>
    <script type="text/javascript" src="js/image-markup.js"></script>
    <script type="text/javascript" src="js/lba_adaptor.js"></script>
    <script type="text/javascript" src="js/spectrum.js"></script>
    <script type="text/javascript">
        console.log("Mostrando IFRAME");
        
        var markup = null;
        
        $(document).ready(function(){
            $("#custom-color").spectrum({
                showPaletteOnly: true,
                showPalette: true,
                color: 'red',
                palette: [
                    ['black', 'white', 'blanchedalmond',
                    'rgb(255, 128, 0);', 'hsv 100 70 50'],
                    ['red', 'yellow', 'green', 'blue', 'violet']
                ]
            });

            $("#custom-color").on("change.color", function(event, color){
                console.log("Color escogido: ");
                console.log(color);
    //            console.log(color.toRgb());
                console.log(color.toString());
                console.log(color.toHexString());

                var markup = window.current_image_markup;
//                markup.setPenColor(color.toString());
                markup.setPenColor(color.toHexString());
            });            
        });
        
        function tb_undo() {
            console.log("UNDO presionado");
            
            CommandManager.undo();            
            paper.view.draw();
        }
        function tb_redo() {
            console.log("UNDO presionado");
            
            CommandManager.redo();            
            paper.view.draw();
        }
        function tb_text() {
            console.log("TEXT presionado");
//            var markup = window.current_image_markup;
//            console.log("markup");
//            console.log(markup);
//            markup.setText();
            markup.setText();
            
            paper.view.draw();
        }
        function tb_select() {
            markup.current_tool = "select";
            markup.setSelect();
        }
        function tb_pen() {
            markup.current_tool = "pen";
            var color = $("#custom-color").spectrum('get');
//            console.log(color);
//            console.log(color.toString());
//            console.log(color.toHexString());
            markup.setPenColor(color.toHexString());
        }
    </script>
</body>
</html>
