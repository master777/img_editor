<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Image Markup</title>
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/paper-core.js"></script>
    <script src="js/paper-core.min.js"></script>
    <script src="js/paper-full.js"></script>
    <script src="js/paper-full.min.js"></script>    
    <!--<script src="js/lba_adaptor.js"></script>-->
    <link href="css/image-markup.css" rel="stylesheet" />
    <link href="contextMenu/jquery.contextMenu.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="css/spectrum.css" />
</head>
<body>
    <div>
        <div id="toolbar">
            <div id="toolbar-container">
                <span class="select-icon img-tool" onclick="tb_select()"></span>            
                <span class="rectangle-icon img-tool" onclick="tb_rectangle()"></span>            
                <span class="ellipse-icon img-tool" onclick="tb_ellipse()"></span>
                <span class="line-icon img-tool" onclick="tb_line()"></span>
                <span class="pen-icon img-tool" onclick="tb_pen()"></span>
                <span class="text-icon img-tool" onclick="tb_text()"></span>             
                <span class="eraser-icon img-tool" onclick="tb_erase()"></span>
                <span class="undo-icon img-tool" onclick="tb_undo()"></span>
                <span class="redo-icon img-tool" onclick="tb_redo()"></span>             
                <span class="clear-all img-tool" onclick="tb_clear_all()"></span>             
                <span class="save-as img-tool" onclick="tb_save_as()"></span>             
                <input type='text' id="custom-color" />    
            </div>
        </div>
        <br/>
        <div id="img-container" class="img-container"><img id="img-editable" src="#" alt="Editable Image" /></div>
        <div id="img_editor_loading"></div>
    </div>

    <script src="js/CommandManager.js"></script>
    <script type="text/javascript" src="contextMenu/jquery.contextMenu.js"></script>
    <script type="text/javascript" src="contextMenu/jquery.ui.position.js"></script>
    <script type="text/javascript" src="js/image-markup.js"></script>
    <script type="text/javascript" src="js/lba_adaptor.js"></script>
    <script type="text/javascript" src="js/spectrum.js"></script>
    <script type="text/javascript">
        console.log("Mostrando IFRAME");
        
        var markup = null;
        var color = null;
        
        $(document).ready(function(){
            $("#custom-color").spectrum({
                showPaletteOnly: true,
                showPalette: true,
                hideAfterPaletteSelect:true,
                color: 'red',
                palette: [
                    ['black', 'white', 'blanchedalmond',
                    'rgb(255, 128, 0);', 'hsv 100 70 50'],
                    ['red', 'yellow', 'green', 'blue', 'violet']
                ]
            });
            
            color = $("#custom-color").spectrum('get');

            $("#custom-color").on("change.color", function(event, color){
                console.log("Color escogido: ");
                console.log(color);
    //            console.log(color.toRgb());
                console.log(color.toString());
                console.log(color.toHexString());

                var markup = window.current_image_markup;
//                markup.setPenColor(color.toString());
                markup.setPenColor(color.toHexString());
            });
            
            $(".img-tool").click(function(){
                console.log('tool selected');
                $(".img-tool").removeClass('active-tool');
                $(this).addClass('active-tool');
            });
        });
        
        function tb_undo() {
            console.log("UNDO presionado");
            
            CommandManager.undo();            
            paper.view.draw();
        }
        function tb_redo() {
            console.log("UNDO presionado");
            
            CommandManager.redo();            
            paper.view.draw();
        }
        function tb_text() {
            console.log("TEXT presionado");
//            var markup = window.current_image_markup;
//            console.log("markup");
//            console.log(markup);
//            markup.setText();
            markup.setText();
            
            paper.view.draw();
        }
        function tb_select() {
            markup.current_tool = "select";
            markup.setSelectIcon();
        }
        function tb_pen() {
            markup.current_tool = "pen";
            var color = $("#custom-color").spectrum('get');
//            console.log(color);
//            console.log(color.toString());
//            console.log(color.toHexString());
            markup.setPenColor(color.toHexString());
        }
        function tb_ellipse(){
            markup.current_tool = "ellipse";
            markup.setPenIcon();
        }
        function tb_line(){
            markup.current_tool = "line";
            markup.setPenIcon();
        }
        function tb_rectangle(){
            markup.current_tool = "rectangle";
            markup.setPenIcon();
        }
        function tb_erase(){
            markup.current_tool = "erase";
            markup.setEraserIcon();
        }
        function tb_clear_all(){
            markup.erase_all();
        }
        function tb_save_as(){
            markup.download();
        }
    </script>
</body>
</html>
